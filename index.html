<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>レジシステム統合</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      overflow: hidden; /* 全体スクロール禁止 */
      width: 100%;
    }
    body {
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="h-full bg-gray-100">

  <!-- 全体コンテナ -->
  <div class="w-full h-full max-w-4xl mx-auto bg-white shadow-2xl rounded-lg flex flex-col min-h-0">

    <!-- レジ1: 商品選択 -->
    <div id="screen1" class="w-full h-full hidden flex flex-col">
      <!-- ヘッダー -->
      <header class="bg-gray-800 text-white p-4 flex justify-between items-center flex-shrink-0">
    <h1 class="text-xl font-bold">レジ：商品選択</h1>
    <div>
      <button class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition mr-2">商品管理</button>
      <button class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition">取引履歴</button>
    </div>
  </header>

  <!-- メイン -->
  <main class="flex-grow p-4 grid grid-cols-1 md:grid-cols-3 gap-4 min-h-0">

    <!-- 商品一覧 -->
    <div id="product-list"
         class="md:col-span-2 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-3 gap-0 p-1 bg-gray-50 rounded-lg overflow-auto no-scrollbar min-h-0">
      <!-- JSで追加 -->
    </div>

    <!-- ご注文内容 -->
    <div class="md:col-span-1 bg-gray-100 p-4 rounded-lg flex flex-col min-h-0">
      <h2 class="text-lg font-bold border-b pb-2 mb-4 flex-shrink-0">ご注文内容</h2>

      <!-- リストだけスクロール -->
      <div id="cart-items" class="flex-grow overflow-y-auto no-scrollbar space-y-2 min-h-0">
        <p class="text-gray-500">商品が選択されていません。</p>
      </div>

      <!-- 下部パネル -->
      <div class="mt-3 flex-shrink-0 space-y-2">
        <!-- 無料券操作 -->
        <div class="flex items-center justify-between w-full bg-orange-500 text-white font-bold py-1 rounded-lg">
          <button id="decrease-coupon-btn" class="text-2xl px-4 py-1 rounded-l-lg hover:bg-orange-600 transition">-</button>
          <span class="flex-grow text-center">無料券 <span id="coupon-count">0</span>枚</span>
          <button id="increase-coupon-btn" class="text-2xl px-4 py-1 rounded-r-lg hover:bg-orange-600 transition">+</button>
        </div>

        <!-- 削除ボタン -->
        <button id="remove-selected-btn"
                class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-lg transition disabled:bg-gray-400"
                disabled>削除</button>

        <!-- 合計表示＋会計 -->
        <div class="border-t pt-4">
          <div id="discount-row" class="flex justify-between items-center text-lg text-red-500 hidden">
            <span>割引 (無料券)</span>
            <span id="discount-amount">¥0</span>
          </div>
          <div class="flex justify-between items-center text-2xl font-bold">
            <span>合計</span>
            <span id="total-amount-display">¥0</span>
          </div>
          <button id="checkout-button"
                  class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg mt-4 transition">
            会計へ進む
          </button>
        </div>
      </div>
    </div>
  </main>

    <!-- レジ1専用スクリプト -->
    <script>
      // 商品データ（例）
      const products = [
        { id: 1, name: "りんご", flavor: "", price: 100 },
        { id: 2, name: "ジュース", flavor: "オレンジ", price: 150 },
        { id: 3, name: "パン", flavor: "", price: 200 },
      ];

      let cart = [];
      let selectedItemId = null;
      let couponCount = 0;

      const productList = document.getElementById("product-list");
      const cartItems = document.getElementById("cart-items");
      const totalAmountDisplay = document.getElementById("total-amount-display");
      const discountRow = document.getElementById("discount-row");
      const discountAmount = document.getElementById("discount-amount");
      const couponCountEl = document.getElementById("coupon-count");
      const removeSelectedBtn = document.getElementById("remove-selected-btn");

      // 商品一覧表示
      function renderProducts() {
        productList.innerHTML = "";
        products.forEach(p => {
          const card = document.createElement("div");
          card.className = "p-3 border rounded-lg shadow hover:bg-gray-50 cursor-pointer";
          card.innerHTML = `
            <div class="font-bold">${p.name}</div>
            <div class="text-sm text-gray-500">${p.flavor || ""}</div>
            <div class="text-gray-800">¥${p.price}</div>
          `;
          card.onclick = () => addToCart(p);
          productList.appendChild(card);
        });
      }

      // カートに追加
      function addToCart(product) {
        const existing = cart.find(i => i.id === product.id);
        if (existing) {
          existing.quantity++;
        } else {
          cart.push({ ...product, quantity: 1, coupon: 0 });
        }
        renderCart();
      }

      // カート描画
      function renderCart() {
        cartItems.innerHTML = "";
        if (cart.length === 0) {
          cartItems.innerHTML = `<p class="text-gray-500">商品が選択されていません。</p>`;
          updateTotal();
          return;
        }

        cart.forEach(item => {
          const row = document.createElement("div");
          row.className = `p-2 border rounded bg-white cart-item ${selectedItemId === item.id ? "selected" : ""}`;

          row.innerHTML = `
            <div class="flex justify-between">
              <span class="font-bold">${item.name}</span>
              <span class="font-bold">¥${item.price}</span>
            </div>
            <div class="text-sm text-gray-500">${item.flavor || ""}</div>
            <div class="flex items-center justify-between mt-1 text-sm">
              <span>数量: ${item.quantity} │ 券: ${item.coupon}</span>
              <div class="space-x-1">
                <button class="px-2 py-1 bg-gray-200 rounded">－</button>
                <button class="px-2 py-1 bg-gray-200 rounded">＋</button>
                <button class="px-2 py-1 bg-red-400 text-white rounded">×</button>
              </div>
            </div>
          `;

          row.onclick = () => {
            selectedItemId = (selectedItemId === item.id) ? null : item.id;
            renderCart();
          };

          const [btnMinus, btnPlus, btnRemove] = row.querySelectorAll("button");
          btnMinus.onclick = e => { e.stopPropagation(); if (item.quantity > 1) item.quantity--; else cart = cart.filter(i => i.id !== item.id); renderCart(); };
          btnPlus.onclick = e => { e.stopPropagation(); item.quantity++; renderCart(); };
          btnRemove.onclick = e => { e.stopPropagation(); cart = cart.filter(i => i.id !== item.id); renderCart(); };

          cartItems.appendChild(row);
        });

        removeSelectedBtn.disabled = selectedItemId === null;
        updateTotal();
      }

      // 合計計算
      function updateTotal() {
        let total = 0;
        let discount = 0;
        cart.forEach(item => {
          total += item.price * item.quantity;
          discount += item.coupon * item.price;
        });

        if (discount > 0) {
          discountRow.classList.remove("hidden");
          discountAmount.textContent = "¥" + discount;
        } else {
          discountRow.classList.add("hidden");
        }

        totalAmountDisplay.textContent = "¥" + (total - discount);
      }

      // 無料券増減
      document.getElementById("increase-coupon-btn").onclick = () => {
        if (cart.length === 0) return;
        const target = cart[0];
        if (target.coupon < target.quantity) {
          target.coupon++;
          couponCount++;
          couponCountEl.textContent = couponCount;
          renderCart();
        }
      };

      document.getElementById("decrease-coupon-btn").onclick = () => {
        if (cart.length === 0) return;
        const target = cart[0];
        if (target.coupon > 0) {
          target.coupon--;
          couponCount--;
          couponCountEl.textContent = couponCount;
          renderCart();
        }
      };

      // 選択削除
      removeSelectedBtn.onclick = () => {
        if (selectedItemId !== null) {
          cart = cart.filter(i => i.id !== selectedItemId);
          selectedItemId = null;
          renderCart();
        }
      };

      // 初期化
      renderProducts();
      renderCart();
    </script>

    <!-- レジ2: お支払い -->
    <div id="screen2" class="w-full h-full hidden flex flex-col">
      <!-- ここにレジ2の中身を入れる -->
    </div>

    <!-- レジ3: お会計完了 -->
    <div id="screen3" class="w-full h-full hidden flex flex-col">
      <!-- ここにレジ3の中身を入れる -->
    </div>

    <!-- レジ4: 商品管理 -->
    <div id="screen4" class="w-full h-full hidden flex flex-col">
      <!-- ここにレジ4の中身を入れる -->
    </div>

    <!-- レジ5: 取引履歴 -->
    <div id="screen5" class="w-full h-full hidden flex flex-col">
      <!-- ここにレジ5の中身を入れる -->
    </div>

  </div>

  <!-- 共通スクリプト -->
  <script>
    // 初期表示
    document.addEventListener("DOMContentLoaded", () => {
      showScreen("screen1");
    });

    // 画面切り替え関数
    function showScreen(id) {
      document.querySelectorAll("body > div > div").forEach(div => div.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }

    // ===== 全画面スクロール禁止 =====
    document.body.addEventListener("touchmove", function(e) {
      if (!e.target.closest(".allow-scroll")) {
        e.preventDefault();
      }
    }, { passive: false });

    // ===== ダブルタップ拡大禁止 =====
    let lastTouchEnd = 0;
    document.addEventListener("touchend", function (event) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, { passive: false });
  </script>
</body>
</html>
